<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · EmulatorsTrainer.jl</title><meta name="title" content="Home · EmulatorsTrainer.jl"/><meta property="og:title" content="Home · EmulatorsTrainer.jl"/><meta property="twitter:title" content="Home · EmulatorsTrainer.jl"/><meta name="description" content="Documentation for EmulatorsTrainer.jl."/><meta property="og:description" content="Documentation for EmulatorsTrainer.jl."/><meta property="twitter:description" content="Documentation for EmulatorsTrainer.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href><img class="docs-light-only" src="assets/logo.svg" alt="EmulatorsTrainer.jl logo"/><img class="docs-dark-only" src="assets/logo-dark.svg" alt="EmulatorsTrainer.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Structure"><span>Structure</span></a></li><li><a class="tocitem" href="#Authors"><span>Authors</span></a></li><li><a class="tocitem" href="#Contributing"><span>Contributing</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CosmologicalEmulators/EmulatorsTrainer.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CosmologicalEmulators/EmulatorsTrainer.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="EmulatorsTrainer.jl"><a class="docs-heading-anchor" href="#EmulatorsTrainer.jl">EmulatorsTrainer.jl</a><a id="EmulatorsTrainer.jl-1"></a><a class="docs-heading-anchor-permalink" href="#EmulatorsTrainer.jl" title="Permalink"></a></h1><p><code>EmulatorsTrainer.jl</code> is a <code>Julia</code> package designed to train the emulators of the <a href="https://github.com/CosmologicalEmulators">CosmologicalEmulators</a> GitHub organization.</p><h2 id="Structure"><a class="docs-heading-anchor" href="#Structure">Structure</a><a id="Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Structure" title="Permalink"></a></h2><p>In order to train and validate an emulator, there are three major steps:</p><ul><li><strong>Dataset creation</strong>. You need to create a dataset of ground-truth prediction (in most of our application, this relies on Boltzmann solvers or Perturbation Theory calculations)</li><li><strong>Emulators training</strong>. After creating the training datasets, we need to actually train the emulators.</li><li><strong>Emulators validation</strong>. The last step is the emulator validation, in order to assess the accuracy of the trained emulator.</li></ul><p><code>EmulatorsTrainer.jl</code> provides utilities for each of this three steps.</p><h3 id="Dataset-creation"><a class="docs-heading-anchor" href="#Dataset-creation">Dataset creation</a><a id="Dataset-creation-1"></a><a class="docs-heading-anchor-permalink" href="#Dataset-creation" title="Permalink"></a></h3><p>According to the emulator you are training (<code>Bora.jl</code>, <code>Capse.jl</code>, <code>Effort.jl</code>, etc...), specific dependencies and commands are going to be used. The design principle behind <code>EmulatorsTrainer.jl</code> is that it will contain only functions independent of the specific emulators to be trained. There will be no <code>CAMB</code>, <code>CLASS</code>, <code>pybird</code>, <code>velocileptors</code> dependencies. This is an intentional choice: the user has to write its own functions to compute the ground-truth.</p><p>In order to use the dataset creation feature, you need to write a function that computes your observables and stores it locally. The function object should receive two positional arguments as input, the dictionary with the value of the parameters and the root where to store the results of the computation.</p><div class="admonition is-success"><header class="admonition-header">Examples</header><div class="admonition-body"><p>Although we do not incorporate anything specific in this package, we have a gallery with some working examples.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Again on examples</header><div class="admonition-body"><p>We have not yet released any example. We plan to release a bunch of them in the near future.</p></div></div><p>As usual it is easier to show things, rather than explain them.</p><p>In this example, we are gonna show how to create the dataset for training <code>Capse.jl</code>. Let us start importing the relevant packages.</p><pre><code class="language-julia hljs">using Distributed
using NPZ
using ClusterManagers
using EmulatorsTrainer
using JSON3
using Random</code></pre><p>Using <a href="https://github.com/JuliaParallel/ClusterManagers.jl"><code>ClusterManagers.jl</code></a> we can add some processes that we are gonna use to create the training dataset</p><pre><code class="language-julia hljs">addprocs_lsf(100; bsub_flags=`-q medium -n 2 -M 6094`)</code></pre><div class="admonition is-warning"><header class="admonition-header">Process creation</header><div class="admonition-body"><p>The previous command is specific for my computing farm (an LSF facility) with the resources required for my specific needs. Modify this command as appropriate for your use case!</p></div></div><p>After adding the processes, create a <code>begin</code>-<code>end</code> quote, such as the the following</p><pre><code class="language-julia hljs">@everywhere begin
    using NPZ, EmulatorsTrainer, JSON3, Random, PyCall
    camb = pyimport(&quot;camb&quot;)
    pars = [&quot;ln10As&quot;, &quot;ns&quot;, &quot;H0&quot;, &quot;ombh2&quot;, &quot;omch2&quot;, &quot;tau&quot;]
    lb = [2.5, 0.88, 40., 0.1933, 0.08, 0.02]
    ub = [3.5, 1.05, 100., 0.2533, 0.2, 0.12]


    n = 1000
    s = EmulatorsTrainer.create_training_dataset(n, lb, ub)

    root_dir = &quot;/path/where/save/computed/stuff&quot;

    function camb_script(CosmoDict, root_path)
        rand_str = root_path*&quot;/&quot;*randstring(10)
        mkdir(rand_str)

        stuff = camb_compute(...)

        npzwrite(rand_str*&quot;/stuff.npy&quot;, stuff)

        open(rand_str*&quot;/capse_dict.json&quot;, &quot;w&quot;) do io
            JSON3.write(io, CosmoDict)
        end
    end
end</code></pre><p>What has been done in the previous block?</p><ul><li>We import again the necessary modules, making them available to the loaded processes</li><li>We import camb as well, using <code>PyCall</code></li><li>We create the combination of input cosmological parameters, after setting the lower and the upper bounds (<code>lb</code> and <code>ub</code>)</li><li>We define the <code>camb_script</code> method, which takes as input the dictionary with the input cosmological parameters, computes <code>stuff</code> using <code>CAMB</code> and store both the dictionary and <code>stuff</code> in a generated subfolder</li></ul><div class="admonition is-info"><header class="admonition-header">CAMB and CLASS usage</header><div class="admonition-body"><p>Actually there are no <code>Julia</code> wrapper for either <code>CAMB</code> or <code>CLASS</code>. However, it is still possible to use them within <code>Julia</code>, using thepackages devoted to this goal:</p><ul><li><a href="https://github.com/JuliaPy/PyCall.jl"><code>PyCall.jl</code></a> and <a href="https://github.com/cjdoris/PythonCall.jl"><code>PythonCall.jl</code></a> can be used to call <code>Python</code> code within <code>Julia</code>.</li><li><a href="https://github.com/JuliaPy/Conda.jl"><code>Conda.jl</code></a> and <a href="https://github.com/cjdoris/CondaPkg.jl"><code>CondaPkg.jl</code></a> can be used to manage <code>conda</code>- and <code>pip</code>-installable packages</li></ul><p>This works also with other <code>Python</code> codes such as <code>velocileptor</code> and <code>pybird</code>.</p></div></div><p>After this, the last missing command is</p><pre><code class="language-julia hljs">EmulatorsTrainer.compute_dataset(s, pars, root_dir, camb_script)</code></pre><p>This command will execute <code>camb_script</code> for each combination of input cosmological parameters, using the available processes.</p><h3 id="Emulators-training"><a class="docs-heading-anchor" href="#Emulators-training">Emulators training</a><a id="Emulators-training-1"></a><a class="docs-heading-anchor-permalink" href="#Emulators-training" title="Permalink"></a></h3><h3 id="Emulators-validation"><a class="docs-heading-anchor" href="#Emulators-validation">Emulators validation</a><a id="Emulators-validation-1"></a><a class="docs-heading-anchor-permalink" href="#Emulators-validation" title="Permalink"></a></h3><h2 id="Authors"><a class="docs-heading-anchor" href="#Authors">Authors</a><a id="Authors-1"></a><a class="docs-heading-anchor-permalink" href="#Authors" title="Permalink"></a></h2><ul><li>Marco Bonici, INAF - Institute of Space Astrophysics and Cosmic Physics (IASF), Milano</li><li>Federico Bianchini, PostDoctoral researcher at Stanford</li></ul><h2 id="Contributing"><a class="docs-heading-anchor" href="#Contributing">Contributing</a><a id="Contributing-1"></a><a class="docs-heading-anchor-permalink" href="#Contributing" title="Permalink"></a></h2><p>Pull requests are welcome. For major changes, please open an issue first to discuss what you would like to change.</p><p>Please make sure to update tests as appropriate.</p><h3 id="License"><a class="docs-heading-anchor" href="#License">License</a><a id="License-1"></a><a class="docs-heading-anchor-permalink" href="#License" title="Permalink"></a></h3><p><code>EmulatorsTrainer.jl</code> is licensed under the MIT &quot;Expat&quot; license; see <a href="https://github.com/CosmologicalEmulators/EmulatorsTrainer.jl/blob/main/LICENSE">LICENSE</a> for the full license text.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Tuesday 21 January 2025 15:51">Tuesday 21 January 2025</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
